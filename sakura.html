<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <style>
    
body {
    background: #fff;
    margin: 0px;
    overflow: hidden;
}

a {
    color:#0078ff;
}
    </style>
    
<script src="./three.min.js"></script>    
   
<script>
var SCREEN_WIDTH;
var SCREEN_HEIGHT;

var container;

var particle;

var camera;
var scene;
var renderer;

var mouseX = 0;
var mouseY = 0;

var windowHalfX;
var windowHalfY;

var particles = []; 
var particleImage = new Image(); //THREE.ImageUtils.loadTexture( "http://i.imgur.com/cTALZ.png" );
//particleImage.src = 'http://i.imgur.com/cTALZ.png'; 
particleImage.src = './cTALZ.png'; 

var projector = new THREE.Projector();
var mouse = { x: 0, y: 0 };  
var targetList = []

function init() {
    SCREEN_WIDTH = window.innerWidth;
    SCREEN_HEIGHT = window.innerHeight;
    container;
    particle;
    camera;
    scene;
    renderer;
    mouseX = 0;
    mouseY = 0;
    var  mouse = { x: 0, y: 0 }   
    windowHalfX = window.innerWidth / 2;
    windowHalfY = window.innerHeight / 2;
    container = document.createElement('body');
    document.body.appendChild(container);

    camera = new THREE.PerspectiveCamera( 75, SCREEN_WIDTH / SCREEN_HEIGHT, 1, 10000 );
    camera.position.z = 1000;
    geometry = new THREE.CubeGeometry(50, 50, 50);
    material = new THREE.MeshBasicMaterial({
        color: 0x00ff00,
        wireframe: false
    });

mesh = new THREE.Mesh(geometry, material);

    scene = new THREE.Scene();
    scene.add(camera);
    targetList.push(mesh);
    scene.add(mesh);
        
    renderer = new THREE.CanvasRenderer();
    renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
    var material = new THREE.ParticleBasicMaterial( { map: new THREE.Texture(particleImage) } );
        
    for (var i = 0; i < 500; i++) {

        particle = new Particle3D( material);
        particle.position.x = Math.random() * 2000 - 1000;
        particle.position.y = Math.random() * 2000 - 1000;
        particle.position.z = Math.random() * 2000 - 1000;
        particle.scale.x = particle.scale.y =  1;
        scene.add( particle );
        
        particles.push(particle); 
    }

    container.appendChild( renderer.domElement );
    document.addEventListener('touchstart', onDocumentTouchStart ,  false );
    setInterval(loop, 2000 / 60);
    
}

function onDocumentTouchStart(ev){
    ev.preventDefault();
    if ( ev.touches.length == 1  ) { 
        var rect = ev.target.getBoundingClientRect();    
        mouse.x =  ev.touches[0].clientX - rect.left
        mouse.y =  ev.touches[0].clientY - rect.top
        mouse.x =  (mouse.x / SCREEN_WIDTH) * 2 - 1
        mouse.y = -(mouse.y / SCREEN_HEIGHT) * 2 + 1
        var vector = new THREE.Vector3( mouse.x, mouse.y ,1);
        projector.unprojectVector( camera );
        var ray = new THREE.Raycaster( camera.position, vector.subSelf( camera.position ).normalize() );
        var obj = ray.intersectObjects( targetList );
        if ( obj.length > 0 ){                       
            alert("click!!")
        } 
    }
}

function loop() {

for(var i = 0; i<particles.length; i++) {
        var particle = particles[i]; 
        particle.updatePhysics(); 
        with(particle.position) {
            if(y<-1000) y+=2000; 
            if(x>1000) x-=2000; 
            else if(x<-1000) x+=2000; 
            if(z>1000) z-=2000; 
            else if(z<-1000) z+=2000; 
        }                
    }
    camera.lookAt(scene.position); 
    renderer.render( scene, camera );
}


var TO_RADIANS = Math.PI / 180;

Particle3D = function(material) {
    THREE.Particle.call(this, material);

    //this.material = material instanceof Array ? material : [ material ];
    // define properties
    this.velocity = new THREE.Vector3(0, -8, 0);
    this.velocity.rotateX(randomRange(-45, 45));
    this.velocity.rotateY(randomRange(0, 360));
    this.gravity = new THREE.Vector3(0, 0, 0);
    this.drag = 1;
    // methods... 
};

Particle3D.prototype = new THREE.Particle();
Particle3D.prototype.constructor = Particle3D;

Particle3D.prototype.updatePhysics = function() {
    this.velocity.multiplyScalar(this.drag);
    this.velocity.addSelf(this.gravity);
    this.position.addSelf(this.velocity);
}

THREE.Vector3.prototype.rotateY = function(angle) {
    cosRY = Math.cos(angle * TO_RADIANS);
    sinRY = Math.sin(angle * TO_RADIANS);

    var tempz = this.z;;
    var tempx = this.x;

    this.x = (tempx * cosRY) + (tempz * sinRY);
    this.z = (tempx * -sinRY) + (tempz * cosRY);
}

THREE.Vector3.prototype.rotateX = function(angle) {
    cosRY = Math.cos(angle * TO_RADIANS);
    sinRY = Math.sin(angle * TO_RADIANS);

    var tempz = this.z;;
    var tempy = this.y;

    this.y = (tempy * cosRY) + (tempz * sinRY);
    this.z = (tempy * -sinRY) + (tempz * cosRY);
}

THREE.Vector3.prototype.rotateZ = function(angle) {
    cosRY = Math.cos(angle * TO_RADIANS);
    sinRY = Math.sin(angle * TO_RADIANS);

    var tempx = this.x;;
    var tempy = this.y;

    this.y = (tempy * cosRY) + (tempx * sinRY);
    this.x = (tempy * -sinRY) + (tempx * cosRY);
}


function randomRange(min, max) {
    return ((Math.random() * (max - min)) + min);
}


    
</script>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body  onload="init()">
    
</body>
</html>
