<ion-header>
  <ion-navbar text-center>
    <button ion-button menuToggle icon-only (click)="openMenu()" >
      <ion-icon name='menu'></ion-icon>
    </button>
    <button color="seccond" style="margin-left:10px;height:30px;font-size:80%;width:90%" ion-button (click)="openSearch()" outline  icon-left large><ion-icon name="search"></ion-icon>クリックして検索</button>
    <ion-buttons end>
      <button ion-button icon-only (click)="presentPopover($event)" >
        <ion-icon name="add-circle-outline"></ion-icon>
      </button><br>
    </ion-buttons>
  </ion-navbar>
</ion-header>
<style>
 .div_button button{margin: auto;margin-top:16px; }
</style>
<ion-content  id="target" class="outer-content" no-margin no-padding >
  <div *ngIf="!isLoad"  style="height:100%;width:100%;margin: 0 auto ;text-align:center;">
    <ion-spinner color="zine" style="margin-top:20%;"></ion-spinner>
  </div>
  <span *ngIf="isLoad">
    <ion-slides  style="background-color:white" *ngIf="topBanner.length > 1"  autoplay="3000" loop="true" speed="100" pager="true" class="slides-height" no-padding pager no-margin >
      <ion-slide no-padding *ngFor="let banner of topBanner" tappable  (click)="openBanner(banner)">
        <img [src]="banner.image" />
      </ion-slide>
    </ion-slides>
    <ion-grid style="background-color:white;justify-content: center;" no-padding >
      <ion-row align-items-center no-padding style="width:100%;margin: 0 auto ;text-align:center;margin-left:3px;margin-right:3px;margin-top:0;margin-bottom:0" >
        <ion-col no-margin no-padding align-self-center  width-25 >
          <button ion-fab  style="margin: 0 auto;margin-top:5px;" (click)="openCategory()"color="gord"><ion-icon name="apps"></ion-icon></button>
          <p class="fab-text"><span class="span-text">カテゴリ</span></p>
        </ion-col>
        <ion-col no-margin no-padding width-25>
          <button  style="margin: 0 auto;  position: relative;margin-top:5px;"ion-fab color="gord" (click)="openNearShops()">
            <ion-icon name="pin"></ion-icon>
          </button>
          <p class="fab-text"><span class="span-text">近くのお店</span></p>
        </ion-col>
        <ion-col no-margin no-padding width-25 >
          <button ion-fab (click)="openTopics()"  style="margin: 0 auto;margin-top:5px;"color="gord"><ion-icon name="book"></ion-icon></button>
          <p class="fab-text"><span class="span-text">イベント NEWS</span></p>
        </ion-col>
        <ion-col no-margin no-padding width-25 >
          <button ion-fab color="gord"  style="margin: 0 auto;margin-top:5px;"(click)="openClassifieds()"><ion-icon name="paper"></ion-icon></button>
          <p class="fab-text"><span class="span-text">クラシファイド</span></p>
        </ion-col>
      </ion-row>
    </ion-grid>
    <p style="border-bottom: 1px solid #9f6da9;margin-top:0px;margin-bottom:0"></p>
    <ion-grid  style="" no-padding no-margin tappable (click)="openClassifieds()">
      <ion-row style="width:100%;margin: 0 auto;text-align:center;background-color:white;" no-padding no-margin>
        <ion-col style="background-color:#9f6da9;color:white" align-self-center no-padding no-margin col-3 >
          <div class="classifieds-box" style="">毎日更新！！</div>
          <div  class="classifieds-box2" style="">クラシファイド</div>
        </ion-col>
        <ion-col col-9 no-margin no-padding>
          <div class="microsoft marquee" >
            <div text-nowrap text-start *ngFor="let p of posts" no-margin no-padding padding-right >
              <p style="display:table;">&nbsp;
              <ion-badge [color]="p.bbs_color" class="classified-badge" >{{p.bbs_category}}</ion-badge>
              <span style="display: table-cell; vertical-align: middle; "> &nbsp;{{ p.title | cutPipe:14  }}</span> &nbsp;</p>
            </div>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
    <ion-list no-margin no-padding inset>
      <div><b>お得なキャンペーン</b></div>
      <button no-padding padding-left ion-item *ngFor="let coupon of topCoupons" (click)="openCoupon(coupon.id)" style="-webkit-align-items: center; border-left: 2px solid #a9957d; padding-left: 10px;
        " >
        <div style=" height: 100%;
        display: block;
        vertical-align: 5%;
        "  item-start>
          <img src="{{coupon.image}}" style="width:80px;top:50%;position:sticky;" />
        </div>
        <h6> {{ coupon.name }} </h6>
        <p>
        <span *ngFor="let category of coupon.shop_category">{{category.cate_name}}</span>
        </p>
      </button> 
    </ion-list> 
    <ion-row no-padding>
      <button ion-button color="zine" block (click)="openCoupons()">もっと見る</button>
    </ion-row>
    <ion-list no-padding inset>
      <div><b>イベント　NEWS</b></div>
      <button tappable no-padding padding-left ion-item *ngFor="let topic of topTopics" (click)="openTopic(topic.id)"style="-webkit-align-items: center; border-left: 2px solid #a9957d; padding-left: 10px;">
        <div style=" height: 100%;
        display: block;
        vertical-align: 5%;
        "  item-start>
          <img src="{{topic.s_image}}" style="width:80px;
          display: block;
          vertical-align: 5%;
          " />
        </div>
        <h4> {{topic.title }}<br> </h4>
        <p>{{topic.updated_at}}</p> 
      </button> 
    </ion-list> 
    <ion-row no-padding>
      <button ion-button color="zine" block (click)="openTopics()">もっと見る</button>
    </ion-row>
    <ion-list no-padding inset>
      <div><b>最新口コミ</b></div>
      <ion-item no-padding *ngFor="let evaluate of topEvaluates" style="align-items: flex-start">
        <ion-avatar no-padding item-left  text-wrap (click)="openUserDetail(evaluate.user_id)" class="avatar-marin" style="margin-left: 8px;">
          <img src="{{evaluate.avatar}}">
        </ion-avatar>
        <h6><a style="color:#3b5998" (click)="openUserDetail(evaluate.user_id)" tappable>{{evaluate.name}}</a></h6>
        <h5>{{evaluate.title}}</h5>
        <p style="display:table;">&nbsp;<span style="display: table-cell;
        vertical-align: middle;
        border: 1px solid  #ffb400;
        font-weight: bold;
        background-color: rgba(255, 180, 0, 0.1);
        font-size:0.9rem; color:  #ffb400;
        padding:1px;margin:1px;">店名</span> &nbsp;
      <a (click)="openShop(evaluate.shop_id)"><span class="text-1x" >{{evaluate.shop_name}}</span></a>
        </p>
        <div style="width:100%">
          <div style="float:left">
            <rating [(ngModel)]="evaluate.star" readOnly="true" max="5" emptyStarIconName="star-outline" halfStarIconName="star-half" starIconName="star" nullable="false" (ngModelChange)="onModelChange($event)"> </rating>
          </div>
          <div style="float:right;height:31px;padding-top:7px">
            <p text-nowrap style="font-size:70%;" >
            <span *ngFor="let area of evaluate.shop_area">
              {{area.area_name}}
            </span>
            <span *ngFor="let cate of evaluate.shop_category">
              {{cate.cate_name}}
            </span>
            </p>
          </div>
          <div style="clear:both"></div>
        </div>
        <p text-wrap class="font-gray">{{evaluate.content | cutPipe:100}}</p>
        <div *ngIf="evaluate.content.length > 140" >
          <a (click)="viewPost(evaluate)" tappable style="font-size:0.8rem;">フルテキスト</a>
        </div>
        <ion-row>
          <div *ngFor="let img  of evaluate.shop_evaluate_images">
            <img src="{{img.s_image}}" style="width:75px;height:75px;margin:3px" tappable  />
          </div >
        </ion-row>
        <p>{{evaluate.updated_at}}</p>
        <div class="actions">
          <ion-row (click)="toggleLike(evaluate.id)" no-padding no-margin>
            <ion-col col-1 *ngIf="!likeLoading" no-padding no-margin>
              <ion-icon name="heart" color="danger" [hidden]="!evaluate.likenum"></ion-icon>
              <ion-icon name="heart-outline" color="danger" [hidden]="evaluate.likenum"></ion-icon>
            </ion-col>
            <ion-col col-1 *ngIf="likeLoading" no-padding no-margin>
              <ion-spinner></ion-spinner>
            </ion-col>
            <ion-col col-1  no-padding no-margin>
              <span ion-text color="gray" style="font-size:80%" [hidden]="!evaluate.likenum">{{evaluate.likenum}}</span>
            </ion-col>
            <ion-col col-1  no-padding no-margin align-self-start>
              <span  (click)="viewPost(evaluate)">
                <ion-icon name="ios-text-outline" color="facebook"></ion-icon>
                <span ion-text color="gray" *ngIf="evaluate.shop_comments.length" style="font-size:80%"[hidden]="!evaluate.shop_comments.length">{{evaluate.shop_comments.length}}</span>
              </span>
            </ion-col>
          </ion-row>
        </div>
      </ion-item>
    </ion-list>
    <ion-row no-padding>
      <button ion-button color="zine" block (click)="openEvaluates()">もっと見る</button>
    </ion-row>
  </span>
    <ion-refresher (ionRefresh)="doRefresh($event)">
      <ion-refresher-content>
      </ion-refresher-content>
    </ion-refresher>
</ion-content>
